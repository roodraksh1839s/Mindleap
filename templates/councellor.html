<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counsellor Dashboard | Serene Mind</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#1e293b', // Slate 800
                            muted: '#64748b', // Slate 500
                            accent: '#0f766e', // Teal 700
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <script>
            const COUNSELLOR_NAME = "Dr. Priya Sharma"; // TEMP identity
    </script>


    <style>
        /* * STRICT THEME ENFORCEMENT 
         * Pastel Gradient & Specific Glassmorphism Rules
         */
        
        body {
            /* Mint + Blush + Lavender Gradient */
            background: linear-gradient(135deg, #f0fdfa 0%, #fff1f2 50%, #f5f3ff 100%);
            background-attachment: fixed;
            color: #334155; /* Slate 700 */
        }

        /* The specific glass requirement: 25% opacity white, 12px blur */
        .glass-panel {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.4); /* Slightly more opaque for nav */
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Hover lift effect for cards */
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            background: rgba(255, 255, 255, 0.35); /* Slight brighten on hover */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased">

    <nav class="glass-nav sticky top-0 z-40 w-full px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                    </svg>
                </div>
                <span class="font-bold text-lg text-slate-700 tracking-tight">MindSpace</span>
            </div>

            <div class="flex items-center gap-4">
                <a href="#" class="px-4 py-2 rounded-full text-sm font-medium text-teal-800 bg-white/40 border border-white/50 shadow-sm transition hover:bg-white/60">
                    Home
                </a>
                <a href="#" class="hidden md:block px-4 py-2 rounded-full text-sm font-medium text-slate-600 hover:bg-white/30 transition">
                    Resources
                </a>
                <button class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium text-slate-600 hover:text-red-500 hover:bg-red-50/50 transition group">
                    <span>Logout</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 group-hover:translate-x-1 transition-transform">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-7xl mx-auto px-6 py-10 animate-fade-in-up">
        
        <header class="mb-10 text-center md:text-left">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">Counsellor Appointments</h1>
            <p class="text-slate-500 text-lg">Manage your sessions and schedule efficiently.</p>
        </header>

        <section class="mb-12">
            <div class="flex items-center gap-2 mb-4">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-teal-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-teal-500"></span>
                </span>
                <h2 class="text-lg font-semibold text-slate-700 uppercase tracking-wide text-xs">Happening Now</h2>
            </div>

            <div class="glass-panel rounded-2xl p-6 md:p-8 flex flex-col md:flex-row justify-between items-center border-l-4 border-l-teal-500 shadow-lg">
                <div class="flex flex-col gap-2 text-center md:text-left">
                    <div class="flex items-center justify-center md:justify-start gap-3">
                        <h3 class="text-2xl font-bold text-slate-800">Sarah Jenkins</h3>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 border border-green-200">
                            Ongoing
                        </span>
                    </div>
                    <div class="text-slate-500 flex items-center gap-2 justify-center md:justify-start">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Started 15 mins ago</span>
                    </div>
                </div>

                <div class="mt-6 md:mt-0 flex flex-col md:items-end gap-2">
                    <div class="flex items-center gap-2 text-slate-700 font-medium bg-white/40 px-4 py-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-purple-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                        </svg>
                        Online Video Session
                    </div>
                    <button class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2 rounded-lg font-medium shadow-md transition-colors w-full md:w-auto">
                        Join Room
                    </button>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                Upcoming Sessions
                <span class="bg-slate-200 text-slate-600 text-xs px-2 py-0.5 rounded-full">3</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="glass-panel rounded-2xl p-6 hover-lift flex flex-col justify-between h-full">
                    <div>
                        <div class="flex justify-between items-start mb-4">
                            <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">
                                MJ
                            </div>
                            <span class="px-2 py-1 rounded-md text-xs font-semibold bg-indigo-50 text-indigo-600 border border-indigo-100">
                                Upcoming
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800">Michael Jordan</h3>
                        <p class="text-sm text-slate-500 mb-4">Anxiety Management</p>
                        
                        <div class="space-y-2 text-sm text-slate-600">
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Today
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                2:00 PM - 3:00 PM (1h)
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/40">
                        <button onclick="openModal('Michael Jordan')" class="w-full py-2 px-4 rounded-lg border border-slate-300 text-slate-600 text-sm font-medium hover:bg-white/50 hover:text-slate-800 transition">
                            Reschedule
                        </button>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 hover-lift flex flex-col justify-between h-full">
                    <div>
                        <div class="flex justify-between items-start mb-4">
                            <div class="h-10 w-10 rounded-full bg-rose-100 flex items-center justify-center text-rose-600 font-bold">
                                EL
                            </div>
                            <span class="px-2 py-1 rounded-md text-xs font-semibold bg-indigo-50 text-indigo-600 border border-indigo-100">
                                Upcoming
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800">Emma Lewis</h3>
                        <p class="text-sm text-slate-500 mb-4">Family Therapy</p>
                        
                        <div class="space-y-2 text-sm text-slate-600">
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Tomorrow
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                10:00 AM - 11:00 AM (1h)
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/40">
                        <button onclick="openModal('Emma Lewis')" class="w-full py-2 px-4 rounded-lg border border-slate-300 text-slate-600 text-sm font-medium hover:bg-white/50 hover:text-slate-800 transition">
                            Reschedule
                        </button>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 hover-lift flex flex-col justify-between h-full">
                    <div>
                        <div class="flex justify-between items-start mb-4">
                            <div class="h-10 w-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 font-bold">
                                DK
                            </div>
                            <span class="px-2 py-1 rounded-md text-xs font-semibold bg-indigo-50 text-indigo-600 border border-indigo-100">
                                Upcoming
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800">David Kim</h3>
                        <p class="text-sm text-slate-500 mb-4">Stress & Career</p>
                        
                        <div class="space-y-2 text-sm text-slate-600">
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Dec 19, 2025
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                4:30 PM - 5:30 PM (1h)
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/40">
                        <button onclick="openModal('David Kim')" class="w-full py-2 px-4 rounded-lg border border-slate-300 text-slate-600 text-sm font-medium hover:bg-white/50 hover:text-slate-800 transition">
                            Reschedule
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-xl font-bold text-slate-800 mb-6 opacity-80">Past Sessions</h2>
            
            <div class="space-y-4">
                <div class="glass-panel rounded-xl p-4 flex flex-wrap items-center justify-between opacity-75 hover:opacity-100 transition duration-300">
                    <div class="flex items-center gap-4">
                        <div class="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 text-sm font-bold">
                            AS
                        </div>
                        <div>
                            <h4 class="font-semibold text-slate-700">Alice Smith</h4>
                            <p class="text-xs text-slate-500">Yesterday, 10:00 AM</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 mt-2 sm:mt-0">
                         <span class="text-sm text-slate-500">In-person</span>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-500 border border-slate-200">
                            Completed
                        </span>
                    </div>
                </div>

                <div class="glass-panel rounded-xl p-4 flex flex-wrap items-center justify-between opacity-75 hover:opacity-100 transition duration-300">
                    <div class="flex items-center gap-4">
                        <div class="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 text-sm font-bold">
                            BR
                        </div>
                        <div>
                            <h4 class="font-semibold text-slate-700">Ben Roberts</h4>
                            <p class="text-xs text-slate-500">Dec 15, 2:00 PM</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 mt-2 sm:mt-0">
                        <span class="text-sm text-slate-500">Online</span>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold bg-slate-100 text-slate-500 border border-slate-200">
                            Completed
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <footer class="mt-20 text-center text-slate-400 text-sm pb-6">
            <p>&copy; 2025 Serene Mind Platform. Confidential Counsellor View.</p>
        </footer>

    </main>

    <div id="rescheduleModal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>

        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-2xl glass-panel text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg p-6 bg-white/80">
                
                <div class="mb-5">
                    <h3 class="text-xl font-bold leading-6 text-slate-800" id="modal-title">Reschedule Session</h3>
                    <p class="mt-2 text-sm text-slate-500">Update appointment details for <span id="modalClientName" class="font-semibold text-teal-600">Client</span>.</p>
                </div>

                <form onsubmit="submitReschedule(event)" class="space-y-4">
                    <div>
                        <label for="date" class="block text-sm font-medium text-slate-700 mb-1">New Date</label>
                        <input type="date" id="date" class="block w-full rounded-lg border-slate-200 bg-white/50 text-slate-700 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2.5 border">
                    </div>

                    <div>
                        <label for="time" class="block text-sm font-medium text-slate-700 mb-1">New Time</label>
                        <input type="time" id="time" class="block w-full rounded-lg border-slate-200 bg-white/50 text-slate-700 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2.5 border">
                    </div>
                    
                    <div>
                         <label for="note" class="block text-sm font-medium text-slate-700 mb-1">Reason (Optional)</label>
                         <textarea id="note" rows="2" class="block w-full rounded-lg border-slate-200 bg-white/50 text-slate-700 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2.5 border"></textarea>
                    </div>

                    <div class="mt-6 flex justify-end gap-3">
                        <button type="button" onclick="closeModal()" class="inline-flex justify-center rounded-lg border border-transparent bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-500 focus-visible:ring-offset-2 transition">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center rounded-lg border border-transparent bg-teal-600 px-4 py-2 text-sm font-medium text-white hover:bg-teal-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-500 focus-visible:ring-offset-2 shadow-md transition">
                            Confirm Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openModal(clientName) {
            const modal = document.getElementById('rescheduleModal');
            const clientNameSpan = document.getElementById('modalClientName');
            
            clientNameSpan.textContent = clientName;
            modal.classList.remove('hidden');
            
            // Simple animation handling
            const panel = modal.querySelector('.transform');
            panel.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                panel.classList.remove('scale-95', 'opacity-0');
                panel.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('rescheduleModal');
            modal.classList.add('hidden');
        }
        async function loadCounsellorAppointments() {
    const res = await fetch(`/get-all-appointments`);
    const data = await res.json();

    // Filter only this counsellor
    const myAppointments = data.filter(
        a => a.counselor_name === COUNSELLOR_NAME
    );

    renderUpcoming(myAppointments);
}

function renderUpcoming(appointments) {
    // For now, log to console to verify
    console.log("My appointments:", appointments);

    // NEXT STEP: replace static cards (weâ€™ll do that after confirmation)
}

setInterval(loadCounsellorAppointments, 4000);
loadCounsellorAppointments();

async function updateStatus(appointmentId, status) {
    await fetch("/update-appointment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            appointment_id: appointmentId,
            status: status
        })
    });

    loadCounsellorAppointments();
}
    let CURRENT_APPOINTMENT_ID = null;

    function openModal(clientName, appointmentId) {
        CURRENT_APPOINTMENT_ID = appointmentId;
        document.getElementById('modalClientName').textContent = clientName;
        document.getElementById('rescheduleModal').classList.remove('hidden');
    }

    async function submitReschedule(e) {
        e.preventDefault();

        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const note = document.getElementById('note').value;

        await fetch("/update-appointment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                appointment_id: CURRENT_APPOINTMENT_ID,
                status: "rescheduled",
                date: date,
                time: time,
                remarks: note
            })
        });

        closeModal();
        loadCounsellorAppointments();
    }
</script>

</body>
</html>